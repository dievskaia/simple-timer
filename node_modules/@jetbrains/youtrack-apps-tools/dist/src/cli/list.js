"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.list = list;
const resolve_1 = require("../../lib/net/resolve");
const exit_1 = require("../../lib/cli/exit");
const queryfields_1 = require("../../lib/net/queryfields");
const request_1 = require("../../lib/net/request");
async function list(config) {
    const url = (0, resolve_1.resolve)(config.host, '/api/admin/apps');
    url.searchParams.append('fields', (0, queryfields_1.queryfields)(['id', 'name']));
    url.searchParams.append('$top', '-1');
    const options = {
        headers: {
            'Content-Type': 'application/json',
        },
    };
    const requestParams = (0, request_1.generateRequestParams)(config, url.href, options);
    try {
        const res = await fetch(requestParams);
        let apps = [];
        if (!res.ok) {
            const error = await (0, request_1.prepareErrorMessage)(res);
            throw new Error(error);
        }
        apps = (await res.json());
        apps.forEach(x => {
            print(x.name);
        });
    }
    catch (error) {
        (0, exit_1.exit)(error);
    }
    function print(name) {
        console.log(name);
    }
}
