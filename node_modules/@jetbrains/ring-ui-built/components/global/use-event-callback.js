import { c } from 'react-compiler-runtime';
import { useRef, useLayoutEffect } from 'react';

// TODO deprecate in favor of useEffectEvent after dropping support for React < 19.2
function useEventCallback(fn) {
  const $ = c(4);
  if ($[0] !== "889dd896626d55d7ee8b6d837575138afdbc32f6790b79c2a3b63812dc174b4f") {
    for (let $i = 0; $i < 4; $i += 1) {
      $[$i] = Symbol.for("react.memo_cache_sentinel");
    }
    $[0] = "889dd896626d55d7ee8b6d837575138afdbc32f6790b79c2a3b63812dc174b4f";
  }
  const ref = useRef(null);
  let t0;
  if ($[1] !== fn) {
    t0 = () => {
      ref.current = fn;
    };
    $[1] = fn;
    $[2] = t0;
  } else {
    t0 = $[2];
  }
  useLayoutEffect(t0);
  let t1;
  if ($[3] === Symbol.for("react.memo_cache_sentinel")) {
    t1 = (...t2) => {
      const args = t2;
      const {
        current
      } = ref;
      if (current === null || current === undefined) {
        throw new Error("callback created in useEventCallback can only be called from event handlers");
      }
      return current(...args);
    };
    $[3] = t1;
  } else {
    t1 = $[3];
  }
  return t1;
}

export { useEventCallback as default };
