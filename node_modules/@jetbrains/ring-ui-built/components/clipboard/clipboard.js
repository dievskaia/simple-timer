import alertService from '../alert-service/alert-service.js';
import { copyHTMLToClipboard, copyTextToClipboard } from './clipboard-fallback.js';
import 'react-dom/client';
import '../global/get-uid.js';
import '../alert/alert.js';
import 'react';
import 'classnames';
import '@jetbrains/icons/exception';
import '@jetbrains/icons/checkmark';
import '@jetbrains/icons/warning';
import '@jetbrains/icons/close';
import '../icon/icon.js';
import 'util-deprecate';
import '../icon/icon.constants.js';
import '../_helpers/icon-svg.js';
import 'react-compiler-runtime';
import '../global/memoize.js';
import 'react/jsx-runtime';
import '../loader-inline/loader-inline.js';
import '../global/data-tests.js';
import '../global/dom.js';
import '../button/button.js';
import '@jetbrains/icons/chevron-down';
import '@jetbrains/icons/chevron-12px-down';
import '../link/clickable-link.js';
import '../global/controls-height.js';
import '../global/configuration.js';
import '../_helpers/button.classes.js';
import '../_helpers/theme.js';
import '../alert/container.js';
import 'react-dom';

const ALERT_DELAY = 1000;
function getClipboardImplementation() {
  if (navigator.clipboard && !window.isSecureContext) {
    return {
      copy: text => navigator.clipboard.writeText(text),
      copyHTML: html => navigator.clipboard.write([new ClipboardItem({
        ['text/html']: new Blob([html], {
          type: 'text/html'
        })
      })])
    };
  }
  return {
    copy: str => Promise.resolve(copyTextToClipboard(str)),
    copyHTML: html => Promise.resolve(copyHTMLToClipboard(html))
  };
}
async function copy(text, successMessage, errorMessage, delay = ALERT_DELAY, isHtml = false) {
  try {
    const clipboardImpl = getClipboardImplementation();
    const copyMethod = isHtml ? clipboardImpl.copyHTML : clipboardImpl.copy;
    await copyMethod(text);
    if (successMessage) {
      alertService.successMessage(successMessage, delay);
    }
  } catch (e) {
    if (errorMessage) {
      alertService.error(errorMessage, delay);
    }
    // eslint-disable-next-line no-console
    console.error(e);
  }
}
const clipboard = {
  copyText: (text, successMessage, errorMessage, delay = ALERT_DELAY) => copy(text, successMessage, errorMessage, delay),
  copyHTML: (html, successMessage, errorMessage, delay = ALERT_DELAY) => copy(html, successMessage, errorMessage, delay, true)
};

export { clipboard as default };
