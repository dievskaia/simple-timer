(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=t(e);fetch(e.href,r)}})();async function f(){return window.__ytHostPromise||(console.log("[simple-timer] creating YTApp host promise"),window.__ytHostPromise=YTApp.register()),window.__ytHostPromise}async function u(o,n){return await(await f()).fetchApp(o,Object.assign({scope:!0},n))}async function w(){return(await(await(await f()).fetchApp("backend/getIssueId",{method:"GET",scope:!0})).text()).trim()}async function k(){return u("backend/start-time",{method:"POST"})}async function p(){return u("backend/stop-time",{method:"POST"})}async function S(){return u("backend/get-time",{method:"GET"})}async function T(){return u("backend/reset-tracker",{method:"POST"})}function b(o){return{duration:{minutes:Math.max(0,Math.floor(o))}}}async function I(o,n){const t=await f(),e=`issues/${String(o).trim()}/timeTracking/workItems`;return await t.fetchYouTrack(e,{method:"POST",body:b(n)})}let l=null,s=null,a=0,m=null;function M(o){const n=Math.max(0,Math.floor(o)),t=Math.floor(n/60),i=n%60;return`${t}m ${i}s`}function v(){if(s){const o=Math.floor((Date.now()-s)/1e3);return Math.max(0,a+o)}return Math.max(0,a)}function c(){const o=document.getElementById("start-stop-timer"),n=document.getElementById("save-time"),t=document.getElementById("timer-display"),i=!!s;o.textContent=i?"Stop Timer":"Start Timer",n.style.display=i?"none":"inline-block",t.textContent=`Time Tracked: ${M(v())}`}function h(){l||(console.log("[simple-timer] start ticking"),l=setInterval(c,1e3))}function y(){l&&(console.log("[simple-timer] stop ticking"),clearInterval(l),l=null)}async function g(){try{m=await w(),m||console.error("[simple-timer] Issue ID is empty")}catch{}try{const t=await S();a=Math.max(0,Math.floor(t.trackedSeconds||0)),s=t.runningSince||null}catch(t){console.error("[simple-timer] backendGetTime failed",t),a=0,s=null}const o=document.getElementById("start-stop-timer"),n=document.getElementById("save-time");o.addEventListener("click",async()=>{try{if(!s)s=(await k()).runningSince||Date.now(),h();else{const t=await p();a=Math.max(0,Math.floor(t.totalSeconds||0)),s=null,y()}c()}catch(t){console.error("[simple-timer] Toggle timer failed",t)}}),n.addEventListener("click",async()=>{try{if(s){const i=await p();a=Math.max(0,Math.floor(i.totalSeconds||0)),s=null,y()}c();const t=Math.max(0,Math.floor(a/60));if(t<=0){alert("Nothing to save yet (less than 1 minute tracked).");return}if(!m){alert("Cannot save: issue ID is unknown.");return}await I(m,t),await T(),a=0,s=null,c(),alert(`Saved ${t} minute(s) to work items.`)}catch(t){console.error("[simple-timer] Save time failed",t),alert("Failed to save time. See console for details.")}}),s&&h(),c()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g();
